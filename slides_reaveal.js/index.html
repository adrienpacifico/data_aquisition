
<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Acquisition de donn√©es pour la data science</title>

		<meta name="description" content="A framework for easily creating beautiful presentations using HTML">
		<meta name="author" content="Hakim El Hattab">

		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<link rel="stylesheet" href="dist/reset.css">
		<link rel="stylesheet" href="dist/reveal.css">
		<link rel="stylesheet" href="dist/theme/black.css" id="theme">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="plugin/highlight/monokai.css">
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<section>
					<h3>Acquisition de donn√©es pour la data science</h3>
					<a href="https://revealjs.com">
						<img src="https://www.thibautderoux.com/wp-content/uploads/2020/08/Big-Data.jpg" alt="big data image" style="height: 280px; margin: 0 auto 4rem auto; background: transparent;" class="demo-logo">
					</a>
					<p>
						<small>Cours DESU AMSE <a href="adrienpacifico.github.io"> Adrien Pacifico</a> </small>
						<br>
						<small>adrienpacifico@gmail.com </small>
					</p>
					</section>
					<section data-markdown>
						
						<textarea data-template>
						#### Comment acqu√©rir de la donn√©e pour des projets de data science ? 
						- T√©l√©charger/acquerir un fichier  <!-- .element: class="fragment" data-fragment-index="1" -->
							- Depuis un site web en r√©cup√©rant un seul fichier manuellement.  <!-- .element: class="fragment" data-fragment-index="2" -->
							- Depuis un site web en t√©l√©chargeant automatiquement un ou plusieurs fichiers.  <!-- .element: class="fragment" data-fragment-index="3" -->
						- Utiliser une API <!-- .element: class="fragment" data-fragment-index="4" -->
						- R√©cup√©rer les donn√©es sur une page web (scrapping), ou plusieurs crawling <!-- .element: class="fragment" data-fragment-index="5" -->
						</textarea>
					  </section>
					<section data-markdown style= "text-align: left;font-size: 80%; width: 140%;">
					<textarea data-template>
						## Plan du cours
						### Jour 1
						1. Introduction G√©n√©rale  <!-- .element: class="fragment" data-fragment-index="1" -->
						2. Web scraping  <!-- .element: class="fragment" data-fragment-index="2" -->
						3. API REST  <!-- .element: class="fragment" data-fragment-index="3" -->
						4. Trouver des donn√©es sur le web.  <!-- .element: class="fragment" data-fragment-index="4" -->  

						### Jour 2: Projet pr√©diction prix immobilier <!-- .element: class="fragment" data-fragment-index="5" -->
						1. Faire un mod√®le pr√©dictif de l'immobilier Fran√ßais/Marseillais  <!-- .element: class="fragment" data-fragment-index="6" -->
						2. Trouver et ajouter d'autres donn√©es <!-- .element: class="fragment" data-fragment-index="7" -->
						3. API OSM<!-- .element: class="fragment" data-fragment-index="8" -->
						4. Trouver des donn√©es sur le web.  <!-- .element: class="fragment" data-fragment-index="9" -->
					</textarea>
					</section>
				</section>
				<section>					
					<section data-markdown>	
					<textarea data-template>
					#### Introduction G√©n√©rale
					Pourquoi acqu√©rir de la donn√©e ?    


					Pour faire du ML.   <!-- .element: class="fragment" data-fragment-index="1" -->
					</textarea>
				  </section>
				<section data-markdown>
					<section data-markdown>
						
						<textarea data-template>
						Pourquoi de la donn√©e (en plus) ?   


						Permet d'ajouter des features li√©es aux processus g√©n√©rateur de donn√©es √† notre mod√®le.   <!-- .element: class="fragment" data-fragment-index="1" -->  
						- [Data centric vs model centric AI](https://spectrum.ieee.org/andrew-ng-data-centric-ai):  <!-- .element: class="fragment" data-fragment-index="2" -->
							- Focus more on data quality and diversity than data quality and model optimisation.<!-- .element: class="fragment" data-fragment-index="2" --> 
						</textarea>
					  </section>
					<section data-markdown>
						<textarea data-template>
						#### Objectif de ce cours ?  
						R√©cup√©rer de la donn√©e par divers moyen pour faire des projets de data science.
						
						#### Objectif secondaire:
						Essayer d'appliquer les meilleures pratiques.
						</textarea>
					</section>
					<section data-markdown>
						
						<textarea data-template>
						#### Environnement de d√©veloppement
						- IDE -> your choice, jupyterlab pour mobile
						- environnement -> Image docker jupyterlab avec un conda
						</textarea>
					  </section>
				</section>
					<section  data-markdown>
						<textarea data-template>
							### Trouver des donn√©es (fichiers) sur le web.
							- https://datasetsearch.research.google.com/
							- [data.gouv.fr](www.data.gouv.fr)
							- insee.fr  
							- https://public.opendatasoft.com/explore/?sort=modified
							- kaggle, [OpenML](https://www.openml.org)
							- Autre (tout autre site/API/web scraping) (ou un article qui liste des sources : [exemple](https://www.kdnuggets.com/2021/05/awesome-list-datasets.html?fbclid=IwAR2ByTY3a_JFZoCkUsiSZl4gEcedhX2QdizAfFPMszUaTVDaAKfbwu5uTO0))
						</textarea>
					</section>
					<section  data-markdown>
						<textarea data-template>
							##### Important d'automatiser la requ√™te pour rendre la recherche reproductible.
							- Cookie cutter data science
							- Permalien du fichier
							- Lien de la page ou le fichier a √©t√© trouv√©
							- Methodologie pour trouver la donn√©es
						</textarea>
					</section>
					<section  data-markdown>
						<textarea data-template>
							### Exercice:
							Trouver et ouvrir des fichiers qui pourraient vous int√©resser.
							- Projet accidents de la route (radars, m√©t√©o, distance √† un h√¥pital, prix des carburants, autre ?)

						</textarea>
					</section>
				</section>
				</section>
				<section>
					<section  data-markdown>
						<textarea data-template>
							### T√©l√©charger des fichiers et lire des fichiers

						</textarea>
					</section>
					<section  data-markdown>
						<textarea data-template>
							T√©l√©charger un fichier peut se faire facilement manuellement via son navigateur internet.
							Il est int√©ressant de le faire via du code:
							- √âvite les erreurs humaines.
							- Permet de savoir d'o√π vient la donn√©e
							> Where did the shapefiles get downloaded from for the geographic plots?
							- S'√©conomiser de nombreux clics !

						</textarea>
					</section>
					<section  data-markdown>
						<textarea data-template>
							Bien souvent en observant l'URL on peut conclure sur comment t√©l√©charger une s√©rie de fichiers pour des ann√©es diff√©rentes des d√©partements diff√©rents, etc.
							```python
							import wget
							wget.download(url, file_name)
							```
						</textarea>
					</section>

					<section  data-markdown>
						<textarea data-template>
							Mise en pratique passe au python (Lecture_de_fichiers_sous_plusieurs_formats.ipynb)
						</textarea>
					</section>

				</section>
				<section>
					<section  data-markdown>
						<textarea data-template>
							### API

						</textarea>
					</section>
					<section  data-markdown>
						<textarea data-template>
						Une interface de programmation applicative, est une interface qui d√©finit des interactions entre plusieurs logiciels.
						Elle d√©finit les types d'appels ou requ√™tes qui peuvent √™tre faits, comment les faire, le format des donn√©es, etc.
						</textarea>
					</section>
					<section  data-markdown>
						<textarea data-template>
							Une interface, utilis√©e par des programmes pour interagir sur des applications.
						</textarea>
					</section>
					<section  data-markdown>
						<textarea data-template>
						1. Web API:  
							Celles dont on parle en g√©n√©ral.
						2. Les autres: 
							- librairies et framework (e.g. l'api de pandas)
							- Autres
						</textarea>
					</section>
					<section  data-markdown>
						<textarea data-template>
						### Web API:

						</textarea>
					</section>
					<section  data-markdown>
						<textarea data-template>
							WEB API:
							Une web API permet de faire des requ√™tes http (POST, GET, PUT, DELETE) 
							qui permettent d'avoir une r√©ponse sous forme de json (parfois de xml).

							Il existe de nombreux services qui permettent d'utiliser une api. 
						</textarea>
					</section>
				<section  data-markdown style =  "text-align: left;font-size: 95%; width: 130%;">
					<textarea data-template>
						API Rest:  
						https://www.youtube.com/watch?v=BbZnsN3LSbY

						Le type d'API le plus utilis√©e sur le web.
						Une interface qui permet d'√©tablir une communication entre votre ordinateur et un serveur afin qu'il fournisse des donn√©es. 

						<pre><code data-trim data-noescape>
							http://api.openweathermap.org/data/2.5/weather?
							lat={lat}&lon={lon}&appid={your%api%key}
						</code></pre>

					</textarea>
				</section>
					<section  data-markdown style =  "text-align: left;font-size: 100%; width: 140%;">
					<textarea data-template>
						API:
						1. Publique vs. Priv√©e
						2. Gratuite vs. Payante
						3. Avec  ou sans authentifications (cl√© API)

						https://github.com/public-apis/public-apis  

						https://pokeapi.co/api/v2/pokemon/ditto  

						https://ladataverte.fr
					</textarea>
					</section>
					<section  data-markdown>
					<textarea data-template>
						### API
						A : https://www.programmableweb.com/
						
					</textarea>
					</section>
					<section  data-markdown>
						<textarea data-template>
							### Utiliser une API 
							- coller l'appel dans son navigateur.
							- la commande CURL
							- avec Python
						</textarea>
					</section>
					<section  data-markdown>
						<textarea data-template>
							### Comment utiliser une API en Python ?
							```Python
							import requests
							parameters= {'lat':42.1234, 'long':21.345}
							response = requests.get("http://api.openweathermap.org/data/2.5/weather",
										parameters)
							print(response.status_code) ## 200 si ok, voir https://www.iana.org/assignments/http-status-codes/http-status-codes.xhtml
							
							```
							
							
						</textarea>
					</section>
					<section  data-markdown>
						<textarea data-template>
							Tips:
							- l'utilisation d'API peut varier dans les standards
							- rechercher des exemples en python, puis les modifier
								- chercher exemples en python:
									- directement dans la documentation ([swagger](https://petstore.swagger.io/#/pet/findPetsByStatus))
									- google
									- github/gitlab
									- autre
						</textarea>
					</section>

					<section  data-markdown>
						<textarea data-template>
							### Exemple utilisation d'API JC-Decaux
							https://github.com/SylvainDe/JcDecauxVelibApiTestPython/blob/master/velib.py
							https://developer.jcdecaux.com/#/home
						</textarea>
					</section>
					<section  data-markdown>
						<textarea data-template>
							### Passage √† la pratique
							(1- appels_api.ipynb , JCDecaux_api_call.ipynb)

						</textarea>
					</section>
					<section  data-markdown>
						<textarea data-template>
							### Exercices:
							- Ouvrir un compte utilisateur et r√©cup√©rer le nombre de v√©lo disponible par borne chez JC-Decaux
							- Prennez l'adresse renseign√©e dans la base des accidents de la route et v√©rifier si vous obtenez les m√™mes points GPS.  
							
						</textarea>
					</section>
				</section>


				<section>
					<section data-markdown>
						<textarea data-template>
							Web Scraping
						</textarea>
					</section>
					<section data-markdown>
						<textarea data-template>
							Le web scraping consiste √† r√©cup√©rer des donn√©es sp√©cifiques sur une ou plusieurs page web.
							Quand on r√©cup√®re l'ensemble d'un site web, on parle de web crawling.
						</textarea>
					</section>
					<section data-markdown>
						<textarea data-template>
							Exemple code source page web.
							
						</textarea>
					</section>
					<section data-markdown style =  "text-align: left;font-size: 80%; width: 100%;">
						<textarea data-template>
							Web Scraping = Game over  
							Il faut tout faire pour √©viter de passer par du web scraping. Cela doit √™tre une solution de dernier recours.

							Solutions en amont:
							1. Trouver une base de donn√©e contenant d√©j√† les informations
							2. Trouver une API permettant d'obtenir les informations
							3. Contacter le gestionnaire du site web pour essayer d'obtenir les informations (achat si entreprise, üê± si recherche/associatif/projet perso )
							4. Web Scraping
						</textarea>
					</section>
					<section data-markdown>
						<textarea data-template>
							#### Pourquoi le Web Scraping c'est pas terrible ?
							1. Mauvais dans un pipeline de donn√©es
							2. Potentiellement ill√©gal (risque juridique : https://www.sales-hacking.com/post/legal-web-scraping)
							3. Demande des comp√©tences techniques de plus en plus √©lev√©es (contre mesures anti-scrapping)
								- cloacking, lien js, captcha, etc
							4. Normalement plus long que toutes les autres solutions.
						</textarea>
					</section>
					<section data-markdown>
						<textarea data-template>
							#### Mauvais dans un pipeline de donn√©es
							- Le format d'une page web peut changer √† tout moment
							- Le code d√©velopp√© peut devenir tr√®s co√ªteux √† maintenir/avoir un gros co√ªt de maintenance
						</textarea>
					</section>
					<section data-markdown  style =  "text-align: left;font-size: 60%; width: 100%;">
						<textarea data-template>
							#### Potentiellement ill√©gal
							- Il existe un risque juridique √† r√©cup√©rer de la donn√©e.
								- Ne respecte pas le terme of use du site
								- A un co√ªt pour le site et peut perturber son fonctionnement (38% du traffic web)/Dos attacks  

							Normalement pas trop de risque si effectu√© sans connexion, sans faire trop de requ√™tes et si pas de r√©utilisation publique.  

							Mais on reste dans un relatif flou juridique.
							> Unfortunately, there‚Äôs not a cut-and-dry answer here. Some websites explicitly allow web scraping. Others explicitly forbid it. Many websites don‚Äôt offer any clear guidance one way or the other.
						</textarea>
					</section>
					<section data-markdown>
						<textarea data-template>
							#### S'assurer de la l√©galit√©.
							1. Conditions d'utilisation du site
								- peuvent parfois pr√©ciser si on peut ou non crawler/scrapper/moissoner le site
							2. Le robots.txt  
								https://www.leboncoin.fr/robots.txt  
								https://fr.wikipedia.org/robots.txt  
						</textarea>
					</section>
					<section data-markdown>
						<textarea data-template>
						####  Demande des comp√©tences techniques
						Demande de ma√Ætriser:
						1. Le html (et parfois plus javascript, nodeJS, etc)
						2. De nouveaux outils (BeautifulSoup, Scrappy, Selenium)
						3. Les anti-mesures pour √©chapper aux mesures anti-web scraping
						</textarea>
					</section>
					<section data-markdown>
						<textarea data-template>
							####  Web Scraping
							Librairies:
							- BeautifulSoup $\rightarrow$ facile mais lent
							- Scrappy $\rightarrow$ difficile, mais rapide (threading)
							- Selenium $\rightarrow$ difficile, √©tudi√© pour du test ([blog post d√©conseillant selenium](http://buklijas.info/blog/2018/12/15/do-not-use-selenium-for-web-scraping/))
						</textarea>
					</section>
					<section data-markdown>
						<textarea data-template>
							####  Web scraping avec BeautifulSoup
							1. T√©l√©charger une page web avec une URL (librairie `requests`)
							2. Ouvrir le code HTML avec BeautifulSoup
							3. Chercher les informations √† partir des tags HTML et attributs css et tag javascript
							4. les mettre dans une dataframe pandas
						</textarea>
					</section>
					<section data-markdown>
						<textarea data-template>
							####  Principaux tags html
							```html
							<div> balise de type block
							<span> balise de type inline
							<iframe>
							<h2> titre niveau 2
							<a> lien hypertexte
							<ul> liste (<ol> pour num√©rot√©)
							<table> tableau
							<p> paragraphe
							...
							(liste absolument pas exhaustive)
							```
						</textarea>
					</section>
					<section data-markdown>
						<textarea data-template>
							Mais avant de se lancer dans du vrai web-scraping, on peut utiliser `pd.read_html("www.monsite.fr")`
							- Cela va r√©cup√©rer l'ensemble des tableaux (`<table>`) que l'on trouve dans une page web.

						</textarea>
					</section>
					<section data-markdown>
						<textarea data-template>
							1. Projet Star Academy : Quel est l'age moyen des participants √† la Star Academy ?
							2. Projet Rolex:  
								Est-ce que le prix des Rolex a un rendement sup√©rieur au march√© ?
						</textarea>
					</section>
				</section>
				<section>
					<section  data-markdown>
					<textarea data-template>
						### Projet accident de la route
						Vous venez d'√™tre recrut√© par l‚ÄôObservatoire national interminist√©riel de la s√©curit√© routi√®re (ONISR) en tant que data scientist.  

						On vous demande √† partir des donn√©es interne de l'OSNIR √† partir des fichiers BAAC en open data, mais aussi de toute autre donn√©e externe de cr√©er de la√† partir de ces donn√©es.						
					</textarea>
					</section>
					<section  data-markdown>
						<textarea data-template>
							![](./images/Ds_project.png)		
							(source Machine Learning Engineering with MLflow)		
						</textarea>
					</section>
					<section  data-markdown>
						<textarea data-template>
							### D√©marrer le projet
							- Objectifs
							- Cr√©er un repo git, avec √©ventuellement une plateforme Devops en place
							- Distance √† un h√¥pital
							- Les donn√©es que vous souhaitez !				
						</textarea>
						</section>

					<section  data-markdown>
					<textarea data-template>
						### Donn√©es √† rajouter
						- Prix de l'essence
						- M√©t√©o lors de l'accident
						- Distance √† un h√¥pital
						- Les donn√©es que vous souhaitez !				
					</textarea>
					</section>

					<section  data-markdown>
					<textarea data-template>
						### Bonnes pratiques:
						- Image Docker (pour reproductibilit√© et mise en prod) (pourquoi docker : https://twitter.com/jeremyphoward/status/1298464399527514113?s=20)
						- Cookie Cutter Data Science (pour pas √™tre brouillon)
						- MLFlow pour garder trace des mod√®les et des exp√©rimentations.
						- Pyjanitor (pour gagner du temps)
						- test sur les donn√©es (des asserts, greater expectations, engarde, tests unitaires sur les fonctions,etc)
					</textarea>
					</section>





				<section>
					<section  data-markdown>
					<textarea data-template>
						### Projet immobilier
						- DVM 2020
						- Nettoyer rapidement
						- Auto-ML rapide
						- Rajouter des donn√©es pour voir l'augmentation de la performance.						
					</textarea>
					</section>

					<section  data-markdown>
					<textarea data-template>
						### Donn√©es √† rajouter
						- Diagnostique √©nerg√©tique
						- Donn√©es sociales par IRIS (revenu, etc)
						- Donn√©es sur les am√©nit√©s (avec l'API openstreetmap)
						  - Distance √† une √©cole, cr√®che, hopital, etc.
						- Les donn√©es que vous souhaitez !				
					</textarea>
					</section>

					<section  data-markdown>
					<textarea data-template>
						### Bonnes pratiques:
						- Image Docker (pour reproductibilit√© et mise en prod) (pourquoi docker : https://twitter.com/jeremyphoward/status/1298464399527514113?s=20)
						- Cookie Cutter Data Science (pour pas √™tre brouillon)
						- MLFlow pour garder trace des mod√®les et des exp√©rimentations.
						- Pyjanitor (pour gagner du temps)
						- test sur les donn√©es (des asserts, greater expectations, engarde, tests unitaires sur les fonctions,etc)
					</textarea>
					</section>



				</section>


			</div>

		</div>

		<script src="plugin/math/math.js"></script>
		<script src="dist/reveal.js"></script>
		<script src="plugin/zoom/zoom.js"></script>
		<script src="plugin/notes/notes.js"></script>
		<script src="plugin/search/search.js"></script>
		<script src="plugin/markdown/markdown.js"></script>
		<script src="plugin/highlight/highlight.js"></script>
		<script>
			// More info about initialization & config:
			// - https://revealjs.com/initialization/
			// - https://revealjs.com/config/
			Reveal.initialize({
				hash: true,
				slideNumber: 'c/t',

				// Learn about plugins: https://revealjs.com/plugins/
				plugins: [RevealZoom, RevealMarkdown, RevealHighlight, RevealNotes, RevealMath ]
			});

		</script>

	</body>
</html>
